<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ros_chrono · MAVs</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link href="../../../../assets/documenter.css" rel="stylesheet" type="text/css"/><link href="../../../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>MAVs</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../../../search.html"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../../../index.html">Home</a></li><li><span class="toctext">Usage</span><ul><li><a class="toctext" href="../../../../tutorials/basic.html">Basic usage</a></li><li><a class="toctext" href="../../../../tutorials/developer.html">Developing MAVs</a></li></ul></li><li><span class="toctext">Sensing</span><ul><li><a class="toctext" href="../../gazebo/vehicle_description/main.html">vehicle_description</a></li><li><a class="toctext" href="../../gazebo/contact_sensor/main.html">contact_sensor</a></li></ul></li><li><span class="toctext">Detection</span><ul><li><a class="toctext" href="../../../computing/perception/obstacle_detector/main.html">obstacle_detector</a></li></ul></li><li><span class="toctext">Vehicle model</span><ul><li class="current"><a class="toctext" href="main.html">ros_chrono</a><ul class="internal"><li><a class="toctext" href="#Mode-1:-dynamic-path-following-1">Mode 1: dynamic path following</a></li><li><a class="toctext" href="#Mode-2:-dynamic-steering-trajectory-following-1">Mode 2: dynamic steering trajectory following</a></li><li><a class="toctext" href="#Mode-3:-dynamic-speed-trajectory-following-1">Mode 3: dynamic speed trajectory following</a></li><li><a class="toctext" href="#Mode-4:-dynamic-speed-and-steering-trajectory-following-1">Mode 4: dynamic speed and steering trajectory following</a></li><li><a class="toctext" href="#All-Modes-1">All  Modes</a></li><li><a class="toctext" href="#Settings-1">Settings</a></li><li><a class="toctext" href="#Flags-1">Flags</a></li><li><a class="toctext" href="#Topics-1">Topics</a></li><li><a class="toctext" href="#Parameters-1">Parameters</a></li><li><a class="toctext" href="#demoA-mode-#1:-dynamic-path-following-1">demoA | mode #1: dynamic path following</a></li><li><a class="toctext" href="#MODE2:-dynamic-steering-trajectory-tracking-1">MODE2: dynamic steering trajectory tracking</a></li><li><a class="toctext" href="#MODE3:-dynamic-speed-trajectory-tracking-1">MODE3: dynamic speed trajectory tracking</a></li><li><a class="toctext" href="#MODE4:-dynamic-speed-trajectory-tracking-1">MODE4: dynamic speed trajectory tracking</a></li><li><a class="toctext" href="#OLD-(below-this)-1">OLD (below this)</a></li><li><a class="toctext" href="#To-run-1">To run</a></li><li><a class="toctext" href="#Expected-Output-5">Expected Output</a></li><li><a class="toctext" href="#To-run-velocity-test-1">To run velocity test</a></li><li><a class="toctext" href="#Expected-Output-6">Expected Output</a></li><li class="toplevel"><a class="toctext" href="#![link](images/demo_velocity_control.png)-1"><img src="images/demo_velocity_control.png" alt="link"/></a></li><li><a class="toctext" href="#To-run-steering-tracking-test-1">To run steering tracking test</a></li><li><a class="toctext" href="#Expected-Output-7">Expected Output</a></li><li><a class="toctext" href="#Miscellaneous-notes-(may-be-outdated!)-1">Miscellaneous notes (may be outdated!)</a></li></ul></li></ul></li><li><span class="toctext">Planning</span><ul><li><a class="toctext" href="../../../computing/planning/nloptcontrol_planner/main.html">nloptcontrol_planner</a></li><li><a class="toctext" href="../../../computing/planning/mavs_ros_planner/main.html">mavs_ros_planner</a></li></ul></li><li><span class="toctext">Miscellaneous</span><ul><li><a class="toctext" href="../../../system/system_shutdown.html">system_shutdown</a></li><li><a class="toctext" href="../../../system/data_logging.html">data_logging</a></li><li><a class="toctext" href="../chrono_position_broadcaster/main.html">chrono_position_broadcaster</a></li><li><a class="toctext" href="../ros_chrono_msgs/main.html">ros_chrono_msgs</a></li></ul></li><li><span class="toctext">System demos</span><ul><li><a class="toctext" href="../../../system/demos/demoA.html">demoA</a></li><li><a class="toctext" href="../../../system/demos/demoB.html">demoB</a></li><li><a class="toctext" href="../../../system/demos/demoC.html">demoC</a></li><li><a class="toctext" href="../../../system/demos/demoD.html">demoD</a></li><li><a class="toctext" href="../../../system/demos/demoE.html">demoE</a></li><li><a class="toctext" href="../../../system/demos/demoF.html">demoF</a></li><li><a class="toctext" href="../../../system/demos/demoG.html">demoG</a></li></ul></li><li><span class="toctext">Docker</span><ul><li><a class="toctext" href="../../../../docker/workflow.html">Workflow</a></li><li><a class="toctext" href="../../../../docker/notes.html">Notes</a></li></ul></li><li><a class="toctext" href="../../../../testing/main.html">Testing</a></li><li><a class="toctext" href="../../../../issues/main.html">Troubleshooting</a></li></ul></nav><article id="docs"><header><nav><ul><li>Vehicle model</li><li><a href="main.html">ros_chrono</a></li></ul><a class="edit-page" href="https://github.com/JuliaMPC/AVExamples.jl/blob/master/docs/src/packages/model/chrono/ros_chrono/main.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>ros_chrono</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="ros_chrono-1" href="#ros_chrono-1">ros_chrono</a></h1><p>A HMMWV vehicle model developed in Project <code>Chrono</code> is controlled using <code>ROS</code> parameters by 4 different modes, which are described below.</p><h2><a class="nav-anchor" id="Mode-1:-dynamic-path-following-1" href="#Mode-1:-dynamic-path-following-1">Mode 1: dynamic path following</a></h2><p>[insert description]</p><h3><a class="nav-anchor" id="Input-1" href="#Input-1">Input</a></h3><p>These x-y trajectories obtained from external planners are used to generate a path for the <code>Chrono</code> vehicle to follow. For the standalone path follower demo, <code>planner_namespace = default</code>.</p><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>system/planner/</code></td><td>planner namespace specifying source of target x-y trajectories</td></tr><tr><td><code>/state/chrono/planner_namespace/traj/x</code></td><td>global x position trajectory (m)</td></tr><tr><td><code>/state/chrono/planner_namespace/traj/yVal</code></td><td>global y position trajectory (m)</td></tr></table><h3><a class="nav-anchor" id="Output-1" href="#Output-1">Output</a></h3><p>If an actual vehicle is used or an external model of the vehicle is used, <code>/nloptcontrol_planner/flags/3DOF_plant</code> should be set to <code>false</code>. And the following <code>rosparam</code> states (points) should be set:</p><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>/state/chrono/t</code></td><td>simulation time (s)</td></tr><tr><td><code>/state/chrono/x</code></td><td>global x position (m)</td></tr><tr><td><code>/state/chrono/yVal</code></td><td>global y position (m)</td></tr><tr><td><code>/state/chrono/psi</code></td><td>global heading angle (rad)</td></tr><tr><td><code>/state/chrono/theta</code></td><td>global pitch angle (rad)</td></tr><tr><td><code>/state/chrono/phi</code></td><td>global roll angle (rad)</td></tr><tr><td><code>/state/chrono/ux</code></td><td>velocity in the x direction (vehicle frame) in (m/s)</td></tr><tr><td><code>/state/chrono/v</code></td><td>velocity in the y direction (vehicle frame) in (m/s)</td></tr><tr><td><code>/state/chrono/ax</code></td><td>acceleration in the x direction (vehicle frame) in (m/s^s)</td></tr><tr><td><code>/state/chrono/r</code></td><td>yaw rate about the z direction in (rad/s)</td></tr><tr><td><code>/state/chrono/sa</code></td><td>steering angle at the tire (rad)</td></tr><tr><td><code>/state/chrono/control/thr</code></td><td>Throttle control input mapped from [0 1]</td></tr><tr><td><code>/state/chrono/control/brk</code></td><td>Braking control input mapped from [0 1]</td></tr><tr><td><code>/state/chrono/control/str</code></td><td>Steering control input mapped from [-1 1]</td></tr></table><p>To view states updating while <code>Chrono</code> is running, open another terminal and type:</p><pre><code class="language-none">$ rostopic echo vehicleinfo
</code></pre><p>This displays all states and inputs specified in the <code>veh_status.msg</code> file.</p><h3><a class="nav-anchor" id="Notes-1" href="#Notes-1">Notes</a></h3><h2><a class="nav-anchor" id="Mode-2:-dynamic-steering-trajectory-following-1" href="#Mode-2:-dynamic-steering-trajectory-following-1">Mode 2: dynamic steering trajectory following</a></h2><p>[insert description]</p><h3><a class="nav-anchor" id="Input-2" href="#Input-2">Input</a></h3><h3><a class="nav-anchor" id="Output-2" href="#Output-2">Output</a></h3><h3><a class="nav-anchor" id="Notes-2" href="#Notes-2">Notes</a></h3><h2><a class="nav-anchor" id="Mode-3:-dynamic-speed-trajectory-following-1" href="#Mode-3:-dynamic-speed-trajectory-following-1">Mode 3: dynamic speed trajectory following</a></h2><p>[insert description]</p><h3><a class="nav-anchor" id="Input-3" href="#Input-3">Input</a></h3><h3><a class="nav-anchor" id="Output-3" href="#Output-3">Output</a></h3><h3><a class="nav-anchor" id="Notes-3" href="#Notes-3">Notes</a></h3><h2><a class="nav-anchor" id="Mode-4:-dynamic-speed-and-steering-trajectory-following-1" href="#Mode-4:-dynamic-speed-and-steering-trajectory-following-1">Mode 4: dynamic speed and steering trajectory following</a></h2><p>[insert description]</p><h3><a class="nav-anchor" id="Input-4" href="#Input-4">Input</a></h3><h3><a class="nav-anchor" id="Output-4" href="#Output-4">Output</a></h3><h3><a class="nav-anchor" id="Notes-4" href="#Notes-4">Notes</a></h3><h2><a class="nav-anchor" id="All-Modes-1" href="#All-Modes-1">All  Modes</a></h2><p>The following settings, flags, topics, and parameters apply to all modes.</p><h2><a class="nav-anchor" id="Settings-1" href="#Settings-1">Settings</a></h2><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>system/chrono/flags/gui</code></td><td>Disable/Enable Chrono GUI</td></tr></table><h2><a class="nav-anchor" id="Flags-1" href="#Flags-1">Flags</a></h2><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>system/chrono/flags/initialized</code></td><td>Chrono ROS node is initialized</td></tr><tr><td><code>system/chrono/flags/running</code></td><td>Chrono simulation is running</td></tr></table><h2><a class="nav-anchor" id="Topics-1" href="#Topics-1">Topics</a></h2><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>/vehicleinfo</code></td><td>Vehicle states, inputs, and time</td></tr></table><h2><a class="nav-anchor" id="Parameters-1" href="#Parameters-1">Parameters</a></h2><p>The following parameters with SI units and angles in radians can be modified:</p><table><tr><th>Name</th><th>Description</th></tr><tr><td><code>/case/X0/actual/ax</code></td><td>Initial x acceleration</td></tr><tr><td><code>/state/chrono/X0/theta</code></td><td>Initial pitch</td></tr><tr><td><code>/case/X0/actual/r</code></td><td>Initial yaw rate</td></tr><tr><td><code>/state/chrono/X0/phi</code></td><td>Initial roll</td></tr><tr><td><code>/case/X0/actual/sa</code></td><td>Initial steering angle</td></tr><tr><td><code>/case/X0/actual/ux</code></td><td>Initial x speed</td></tr><tr><td><code>/case/X0/actual/v</code></td><td>Initial velocity</td></tr><tr><td><code>/state/chrono/X0/v_des</code></td><td>Desired velocity</td></tr><tr><td><code>/case/X0/actual/x</code></td><td>Initial x</td></tr><tr><td><code>/case/X0/actual/yVal</code></td><td>Initial y</td></tr><tr><td><code>/case/X0/actual/psi</code></td><td>Initial yaw</td></tr><tr><td><code>/state/chrono/X0/z</code></td><td>Initial z</td></tr><tr><td><code>vehicle/common/Izz</code></td><td>(Moment of Inertia about z axis)</td></tr><tr><td><code>vehicle/common/la</code></td><td>Distance from COM to front axle</td></tr><tr><td><code>/vehicle/common/lb</code></td><td>Distance from COM to rear axle</td></tr><tr><td><code>/vehicle/common/m</code></td><td>Vehicle mass</td></tr><tr><td><code>/vehicle/common/wheel_radius</code></td><td>Wheel radius</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/frict_coeff</code></td><td>Friction Coefficient (Rigid Tire Model)</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/rest_coeff</code></td><td>Restitution Coefficient (Rigid Tire Model)</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/centroidLoc</code></td><td>Chassis centroid location</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/centroidOrientation</code></td><td>Chassis centroid orientation</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/chassisMass</code></td><td>Chassis mass</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/chassisInertia</code></td><td>Chassis inertia</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/driverLoc</code></td><td>Driver location</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/driverOrientation</code></td><td>Driver orientation</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/motorBlockDirection</code></td><td>Motor block direction</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/axleDirection</code></td><td>Axle direction vector</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/driveshaftInertia</code></td><td>Final driveshaft inertia</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/differentialBoxInertia</code></td><td>Differential box inertia</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/conicalGearRatio</code></td><td>Conical gear ratio for steering</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/differentialRatio</code></td><td>Differential ratio</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/gearRatios</code></td><td>Gear ratios (indexed starting from reverse gear ratio and ending at final forward gear ratio)</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/steeringLinkMass</code></td><td>Steering link mass</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/steeringLinkInertia</code></td><td>Steering link inertia</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/steeringLinkRadius</code></td><td>Steering link radius</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/steeringLinkLength</code></td><td>Steering link length</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/pinionRadius</code></td><td>Pinion radius</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/pinionMaxAngle</code></td><td>Pinion max steering angle</td></tr><tr><td><code>/vehicle/chrono/vehicle_params/maxBrakeTorque</code></td><td>Max brake torque</td></tr></table><h2><a class="nav-anchor" id="demoA-mode-#1:-dynamic-path-following-1" href="#demoA-mode-#1:-dynamic-path-following-1">demoA | mode #1: dynamic path following</a></h2><p>[INSERT DESCRIPTION]</p><p>To run:</p><pre><code class="language-none"></code></pre><h3><a class="nav-anchor" id="Expected-Output-1" href="#Expected-Output-1">Expected Output</a></h3><h3><a class="nav-anchor" id="Notes-5" href="#Notes-5">Notes</a></h3><h2><a class="nav-anchor" id="MODE2:-dynamic-steering-trajectory-tracking-1" href="#MODE2:-dynamic-steering-trajectory-tracking-1">MODE2: dynamic steering trajectory tracking</a></h2><p>[INSERT DESCRIPTION]</p><p>To run:</p><pre><code class="language-none"></code></pre><h3><a class="nav-anchor" id="Expected-Output-2" href="#Expected-Output-2">Expected Output</a></h3><h3><a class="nav-anchor" id="Notes-6" href="#Notes-6">Notes</a></h3><h2><a class="nav-anchor" id="MODE3:-dynamic-speed-trajectory-tracking-1" href="#MODE3:-dynamic-speed-trajectory-tracking-1">MODE3: dynamic speed trajectory tracking</a></h2><p>[INSERT DESCRIPTION]</p><p>To run:</p><pre><code class="language-none"></code></pre><h3><a class="nav-anchor" id="Expected-Output-3" href="#Expected-Output-3">Expected Output</a></h3><h3><a class="nav-anchor" id="Notes-7" href="#Notes-7">Notes</a></h3><h2><a class="nav-anchor" id="MODE4:-dynamic-speed-trajectory-tracking-1" href="#MODE4:-dynamic-speed-trajectory-tracking-1">MODE4: dynamic speed trajectory tracking</a></h2><p>[INSERT DESCRIPTION]</p><p>To run:</p><pre><code class="language-none"></code></pre><h3><a class="nav-anchor" id="Expected-Output-4" href="#Expected-Output-4">Expected Output</a></h3><h3><a class="nav-anchor" id="Notes-8" href="#Notes-8">Notes</a></h3><h2><a class="nav-anchor" id="OLD-(below-this)-1" href="#OLD-(below-this)-1">OLD (below this)</a></h2><p>A vehicle model in <code>Chrono</code> that can be used through <code>ROS</code>.</p><p>The vehicle model currently runs with rigid tire models, a rear-wheel driveline, double wishbone suspension (reduced so that the control arm positions are distance constraints), and rack and pinion steering.</p><h2><a class="nav-anchor" id="To-run-1" href="#To-run-1">To run</a></h2><pre><code class="language-none">$ cd $HOME/MAVs/ros
$ roslaunch ros_chrono demo.launch
$ rosparam set system/default/flags/initialized true</code></pre><h2><a class="nav-anchor" id="Expected-Output-5" href="#Expected-Output-5">Expected Output</a></h2><p><img src="images/expectedoutputchronodemo.png" alt="link"/></p><h2><a class="nav-anchor" id="To-run-velocity-test-1" href="#To-run-velocity-test-1">To run velocity test</a></h2><p>Velocity test shows the ability of chorono to exchange information with ros.</p><pre><code class="language-none">$ roslaunch ros_chrono demo_velocity_control.launch</code></pre><h2><a class="nav-anchor" id="Expected-Output-6" href="#Expected-Output-6">Expected Output</a></h2><h1><a class="nav-anchor" id="![link](images/demo_velocity_control.png)-1" href="#![link](images/demo_velocity_control.png)-1"><img src="images/demo_velocity_control.png" alt="link"/></a></h1><h2><a class="nav-anchor" id="To-run-steering-tracking-test-1" href="#To-run-steering-tracking-test-1">To run steering tracking test</a></h2><p>steering tracking test shows the ability of chorono to exchange information with ros.</p><pre><code class="language-none">$ cd $HOME/MAVs/ros
$ roslaunch ros_chrono steering.launch</code></pre><h2><a class="nav-anchor" id="Expected-Output-7" href="#Expected-Output-7">Expected Output</a></h2><p><img src="images/demo_steering.png" alt="link"/> Under a constant speed, the vehicle will be controlled by the steering angle command to follow the steering angle trajectory.</p><h2><a class="nav-anchor" id="Miscellaneous-notes-(may-be-outdated!)-1" href="#Miscellaneous-notes-(may-be-outdated!)-1">Miscellaneous notes (may be outdated!)</a></h2><h3><a class="nav-anchor" id="Change-Vehicle-Initial-Conditions-1" href="#Change-Vehicle-Initial-Conditions-1">Change Vehicle Initial Conditions</a></h3><p>To change initial trajectory edit the parameters in the <code>hmmwv_chrono_params.yaml</code> config file.</p><pre><code class="language-none">$ sudo gedit ros/src/system/config/s1.yaml
</code></pre><p>To change target speed, edit:</p><pre><code class="language-none">$ sudo gedit ros/src/models/chrono/ros_chrono/config/hmmwv_params.yaml</code></pre><h3><a class="nav-anchor" id="Change-Values-of-Updated-Path-1" href="#Change-Values-of-Updated-Path-1">Change Values of Updated Path</a></h3><p>For the path_follower demo, update the parameters of <code>/state/chrono/default/traj/yVal</code>, <code>/state/chrono/default/traj/x</code> in hmmwv_chrono_params.yaml. Change the system/planner parameter to chrono in chrono.yaml. In general, set system/planner to desired planner and update state/chrono/ &lt;planner_name&gt; /traj/x, vehicle/chrono/ &lt;planner_name&gt; /traj/yVal.</p><h3><a class="nav-anchor" id="Current-Differences-between-3DOF-Vehicle-model-and-HMMWV-model:-1" href="#Current-Differences-between-3DOF-Vehicle-model-and-HMMWV-model:-1">Current Differences between 3DOF Vehicle model and HMMWV model:</a></h3><table><tr><th>Name</th><th>3DOF</th><th>Chrono</th><th>Description</th></tr><tr><td><code>Izz</code></td><td>4,110.1</td><td>3,570.2</td><td>Inertia about z axis</td></tr><tr><td><code>la</code></td><td>1.5775</td><td>1.871831</td><td>Distance from COM to front axle</td></tr><tr><td><code>lb</code></td><td>1.7245</td><td>1.871831</td><td>Distance from COM to rear axle</td></tr><tr><td><code>Tire Model</code></td><td>PACEJKA</td><td>RIGID</td><td>Tire model used by vehicle</td></tr></table><footer><hr/><a class="previous" href="../../../computing/perception/obstacle_detector/main.html"><span class="direction">Previous</span><span class="title">obstacle_detector</span></a><a class="next" href="../../../computing/planning/nloptcontrol_planner/main.html"><span class="direction">Next</span><span class="title">nloptcontrol_planner</span></a></footer></article></body></html>
